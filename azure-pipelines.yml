# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

strategy:
  matrix:
    mac:
      python.version: '3.7'
      imageName: 'macos-10.13'
    windows:
      python.version: '3.7'
      imageName: 'vs2017-win2016'

pool:
  vmImage: $(imageName)

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'
  displayName: 'Use Python $(python.version)'

- script:
    python -m pip install --upgrade pip
    pip install --user -r final-requirements.txt
  condition: eq($(imageName), 'vs2017-win2016')
  displayName: 'Install dependencies'

- script:
    python -m pip install --upgrade pip
    pip install -r final-requirements.txt
  condition: eq($(imageName), 'macos-10.13')
  displayName: 'Install dependencies'

- script:
    pyinstaller --onefile --windowed process_tiff.py    
  displayName: 'pyinstaller'

- task: CopyFiles@2
  displayName: 'Copy Files to: $(build.artifactstagingdirectory)'
  inputs:
    SourceFolder: '$(build.sourcesdirectory)'
    Contents: '**/*'
    TargetFolder: '$(build.artifactstagingdirectory)'

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: drop'
  inputs:
    PathtoPublish: '$(build.artifactstagingdirectory)'